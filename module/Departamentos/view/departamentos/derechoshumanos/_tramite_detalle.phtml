<?php

/**
 * Vista genérica para detalle de trámite
 * @var Laminas\View\Renderer\PhpRenderer $this
 * @var array $tramite Datos del trámite desde BD
 */

$this->layout()->menuBackUrl = '/didecosistemas/public/departamentos/derechoshumanos';
$this->headTitle($tramite['nombre']);
?>

<div class="container py-5">
  <h2 class="mb-4">DIDECO - Oficina Municipal de Derechos Humanos</h2>

  <div class="mb-4">
    <h4><?= $this->escapeHtml($tramite['nombre']) ?></h4>
    <p>
      <?= $this->escapeHtml($tramite['descripcion_larga'] ?: $tramite['descripcion_corta']) ?>
    </p>
  </div>

  <div class="accordion mb-5" id="accordionTramite">
    
    <?php if (!empty($tramite['documentos_requeridos'])): ?>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingDoc">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDoc" aria-expanded="false" aria-controls="collapseDoc">
          Documentos Requeridos
        </button>
      </h2>
      <div id="collapseDoc" class="accordion-collapse collapse" aria-labelledby="headingDoc" data-bs-parent="#accordionTramite">
        <div class="accordion-body">
          <?= nl2br($this->escapeHtml($tramite['documentos_requeridos'])) ?>
        </div>
      </div>
    </div>
    <?php endif; ?>

    <?php if (!empty($tramite['requisitos_usuario'])): ?>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingReq">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReq" aria-expanded="false" aria-controls="collapseReq">
          Requisitos del Usuario
        </button>
      </h2>
      <div id="collapseReq" class="accordion-collapse collapse" aria-labelledby="headingReq" data-bs-parent="#accordionTramite">
        <div class="accordion-body">
          <?= nl2br($this->escapeHtml($tramite['requisitos_usuario'])) ?>
        </div>
      </div>
    </div>
    <?php endif; ?>

    <?php if (!empty($tramite['instrucciones_paso_paso'])): ?>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingPaso">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePaso" aria-expanded="false" aria-controls="collapsePaso">
          Instrucciones Paso a Paso
        </button>
      </h2>
      <div id="collapsePaso" class="accordion-collapse collapse" aria-labelledby="headingPaso" data-bs-parent="#accordionTramite">
        <div class="accordion-body">
          <?= nl2br($this->escapeHtml($tramite['instrucciones_paso_paso'])) ?>
        </div>
      </div>
    </div>
    <?php endif; ?>

    <?php if (!empty($tramite['tiempo_estimado'])): ?>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingTiempo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTiempo" aria-expanded="false" aria-controls="collapseTiempo">
          Tiempo Estimado de Respuesta
        </button>
      </h2>
      <div id="collapseTiempo" class="accordion-collapse collapse" aria-labelledby="headingTiempo" data-bs-parent="#accordionTramite">
        <div class="accordion-body">
          <?= $this->escapeHtml($tramite['tiempo_estimado']) ?>
        </div>
      </div>
    </div>
    <?php endif; ?>

    <?php if (!empty($tramite['responsable_nombre'])): ?>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingResponsable">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseResponsable" aria-expanded="false" aria-controls="collapseResponsable">
          Responsable del Trámite
        </button>
      </h2>
      <div id="collapseResponsable" class="accordion-collapse collapse" aria-labelledby="headingResponsable" data-bs-parent="#accordionTramite">
        <div class="accordion-body">
          <?= $this->escapeHtml($tramite['responsable_nombre']) ?>
          <?php if (!empty($tramite['responsable_cargo'])): ?>
            <br><small class="text-muted"><?= $this->escapeHtml($tramite['responsable_cargo']) ?></small>
          <?php endif; ?>
          <?php if (!empty($tramite['responsable_email'])): ?>
            <br><small><?= $this->escapeHtml($tramite['responsable_email']) ?></small>
          <?php endif; ?>
          <?php if (!empty($tramite['responsable_telefono'])): ?>
            <br><small><?= $this->escapeHtml($tramite['responsable_telefono']) ?></small>
          <?php endif; ?>
        </div>
      </div>
    </div>
    <?php endif; ?>

    <?php if (!empty($tramite['observaciones'])): ?>
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingObs">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseObs" aria-expanded="false" aria-controls="collapseObs">
          Observaciones
        </button>
      </h2>
      <div id="collapseObs" class="accordion-collapse collapse" aria-labelledby="headingObs" data-bs-parent="#accordionTramite">
        <div class="accordion-body">
          <?= nl2br($this->escapeHtml($tramite['observaciones'])) ?>
        </div>
      </div>
    </div>
    <?php endif; ?>

    <?php if (empty($tramite['documentos_requeridos']) && empty($tramite['requisitos_usuario']) && empty($tramite['instrucciones_paso_paso']) && empty($tramite['tiempo_estimado']) && empty($tramite['responsable_nombre']) && empty($tramite['observaciones'])): ?>
    <div class="alert alert-info">
      <i class="bi bi-info-circle me-2"></i>
      No hay información adicional disponible para este trámite en este momento.
    </div>
    <?php endif; ?>

  </div>
</div>
