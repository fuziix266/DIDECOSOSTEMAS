<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><?= $this->headTitle('Celulares Municipales')->setSeparator(' - ')->setAutoEscape(false) ?></title>

    <!-- Bootstrap 5 (local) -->
    <link href="/didecosistemas/public/vehiculos/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="/didecosistemas/public/vehiculos/vendors/bootstrap-icons/bootstrap-icons.min.css" rel="stylesheet">
    <!-- SweetAlert2 CSS (opcional) -->
    <link rel="stylesheet" href="/didecosistemas/public/vehiculos/vendors/sweetalert2/sweetalert2.min.css">
    <!-- DataTables CSS (global) -->
    <link rel="stylesheet" href="/didecosistemas/public/vehiculos/vendors/datatables/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="/didecosistemas/public/vehiculos/vendors/datatables/css/responsive.bootstrap5.min.css">
    <!-- Custom styles (mantener colores y forma del layout_web) -->
    <link href="/didecosistemas/public/vehiculos/css/styles.css" rel="stylesheet">

    <style>
        /* Paleta y ajustes similares a layout_web original */
        :root {
            --primary-color: #06048C;
            --bg-light: #F8FAFC;
        }

        .topbar {
            background: var(--primary-color);
            color: #fff;
            font-size: .9rem;
        }

        .topbar a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
        }

        .navbar-municipal {
            background: #ffffff;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.06);
        }

        .nav-link.primary {
            color: var(--primary-color) !important;
            font-weight: 600;
            border-bottom: 3px solid var(--primary-color);
        }

        .btn-rrhh {
            color: #f97316;
            border-color: #f97316;
        }



        .info-card {
            background: rgba(248, 250, 252, 1);
        }

        .search-input .bi {
            font-size: 1.1rem;
        }

        .linea-colores {
            border-bottom: 6px solid;
            border-image: linear-gradient(90deg, #00bb95 25%, #ffca48 25% 50%, #ff6948 50% 75%, #00a7e6 75%) 1;
        }

        .hero {
            height: 260px;
            position: relative;
            background-size: cover;
            background-position: center;
        }

        .hero .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, .35);
            display: flex;
            align-items: center;
        }

        .footer-municipal {
            background: #f8f9fa;
            padding: 2rem 0;
        }

        .footer-municipal .footer-logo {
            max-height: 50px;
            opacity: 0.8;
        }
    </style>

    <?= $this->headLink() ?>
    <?= $this->headStyle() ?>
</head>

<body class="d-flex flex-column min-vh-100" style="background:var(--bg-light);">

    <?php $session = new \Laminas\Session\Container('vehiculos_qr_auth'); ?>

    <!-- Top thin bar (links + social) -->
    <div class="topbar py-1">
        <div class="container d-flex justify-content-between small pt-3 pb-3">
            <div>
                <a href="#" class="me-2">DIP</a>
                <span class="text-white">|</span>
                <a href="#" class="mx-2">Transformación Digital</a>
                <span class="text-white">|</span>
                <a href="#" class="ms-2">Ley del Lobby</a>
            </div>
            <div>
                <a href="#" class="text-white me-2" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
                <a href="#" class="text-white me-2" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
                <a href="#" class="text-white me-2" aria-label="Flickr"><i class="bi bi-camera"></i></a>
                <a href="#" class="text-white" aria-label="YouTube"><i class="bi bi-youtube"></i></a>
            </div>
        </div>
    </div>

    <!-- Header with logo + nav -->
    <header class="navbar-municipal">
        <div class="container py-3 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <img src="/didecosistemas/public/vehiculos/img/logo-azul.png" alt="Logo Municipalidad" style="height:56px;" class="me-3">
            </div>

            <nav class="d-none d-md-block">
                <ul class="nav align-items-center">
                    <li class="nav-item"><a class="nav-link text-muted" href="/didecosistemas/public/aplicaciones"><i class="bi bi-house-door me-1"></i> Inicio</a></li>
                    <li class="nav-item"><a class="nav-link primary" href="/didecosistemas/public/vehiculos/admin"><i class="bi bi-qr-code me-1"></i> Gestión QR</a></li>
                    <li class="nav-item"><a class="nav-link text-muted" href="/didecosistemas/public/vehiculos/admin/generar-lote"><i class="bi bi-plus-circle me-1"></i> Generar QR</a></li>
                    <li class="nav-item"><a class="nav-link text-muted" href="#"><i class="bi bi-person me-1"></i> Inspectores</a></li>
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                        <?php if (isset($session->user_id)): ?>
                            <li class="nav-item dropdown ms-2">
                                <a class="btn btn-outline-warning btn-sm btn-rrhh dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-person-circle me-2 fs-5"></i>
                                    <span class="badge text-dark"><?= $this->escapeHtml($session->rol) ?></span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li class="px-3">
                                        <small class="text-muted">Sesión iniciada como</small>
                                        <div class="fw-bold"><?= $this->escapeHtml($session->correo ?? 'Usuario') ?></div>
                                    </li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <?php if (($session->rol ?? '') === 'ADMIN'): ?>

                                        <li class=""><a class="dropdown-item" href="<?= $this->url('vehiculos-admin-usuarios') ?>"><i class="bi bi-people me-2"></i> Administrar Usuarios</a></li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>
                                    <?php endif; ?>
                                    <li><a class="dropdown-item" href="/vehiculos/editar"><i class="bi bi-pencil-square me-2"></i> Editar Mis Datos</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item text-danger" href="<?= $this->url('vehiculos-logout') ?>"><i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión</a></li>
                                </ul>
                            </li>
                        <?php else: ?>
                            <li class="nav-item"><a class="nav-link" href="<?= $this->url('vehiculos-login') ?>"><i class="bi bi-box-arrow-in-right me-1"></i> Iniciar Sesión</a></li>
                            <li class="nav-item"><a class="nav-link" href="/vehiculos/editar"><i class="bi bi-pencil-square me-1"></i> Editar Datos</a></li>
                        <?php endif; ?>
                    </ul>
                </ul>

            </nav>

            <!-- Mobile toggle for simplicity reuse navbar below if needed -->
            <div class="d-md-none">
                <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#mobileMenu">Menú</button>
            </div>
        </div>
        <div class="linea-colores"></div>


        <div class="collapse" id="mobileMenu">
            <div class="container pb-3">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#">Anexos</a></li>
                    <li class="nav-item"><a class="nav-link active" href="#">Celulares</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Contacto</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Hero -->
    <?php if (!isset($this->layout()->{'visible-hero'}) || $this->layout()->{'visible-hero'}): ?>
        <div class="hero mb-4" style="background-image:url('https://lh3.googleusercontent.com/aida-public/AB6AXuCSn-5mVAiL9UNA4hVTPiIQAa3IDlK2pQBGX8zvNHJfIDDGdJ-5vzcxnb0HcTtb_uNg-d1OKvj8KVtsSZsFCeUhtfP928nn_0jKhRjYpXWIDY4fKW8ErX6cq5QrUmwedJXV3igW8x33ecWG2ySktwcRzrkbnsxvLrdYXz3vQZYCSgUiSciV8ZBGgkdsIe7xk6VXJweVyv_ejYLgBlgrw5doI4iIsKaKsSgtEtY-WlM-cRVE_gv4k7sPzaKNe69NHQvTyWFKK_JLWhbQ');">
            <div class="overlay">
                <div class="container text-white">
                    <?php
                    // Priorizar variables enviadas al layout desde el Action (ej: $this->layout()->setVariable(...))
                    $heroTitle = '';
                    if (isset($this->layout()->heroTitle) && trim((string) $this->layout()->heroTitle) !== '') {
                        $heroTitle = (string) $this->layout()->heroTitle;
                    } else {
                        $heroTitle = trim((string) $this->placeholder('heroTitle'));
                    }

                    if ($heroTitle === '') {
                        $heroTitle = 'Gestión de Códigos QR';
                    }
                    ?>
                    <h1 class="display-6 fw-bold"><?php echo $this->escapeHtml($heroTitle); ?></h1>

                    <?php
                    $heroSubtitle = '';
                    if (isset($this->layout()->heroSubtitle) && trim((string) $this->layout()->heroSubtitle) !== '') {
                        $heroSubtitle = (string) $this->layout()->heroSubtitle;
                    } else {
                        $heroSubtitle = trim((string) $this->placeholder('heroSubtitle'));
                    }
                    if ($heroSubtitle !== ''): ?>
                        <p class="lead mt-2 text-white-50"><?php echo $this->escapeHtml($heroSubtitle); ?></p>
                    <?php endif; ?>

                    <img alt="Logo blanco" src="/didecosistemas/public/vehiculos/img/logo-azul.png" style="height:36px; filter:brightness(0) invert(1);" />
                </div>
            </div>
        </div>
    <?php else: ?>
        <div class="mb-4"></div>
    <?php endif; ?>

    <!-- Main content area -->
    <main class="flex-grow-1">
        <div class=container>
            <!-- Dinamic content from controllers/views -->
            <?= $this->content ?>
        </div>
    </main>

    <!-- Footer Municipal -->
    <footer class="footer-municipal mt-auto">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-4 text-center text-md-start mb-3 mb-md-0">
                    <img src="/didecosistemas/public/vehiculos/img/logo-azul.png"
                        alt="Logo Municipalidad"
                        class="footer-logo">
                </div>
                <div class="col-md-4 text-center mb-3 mb-md-0">
                    <h6 class="fw-bold text-primary mb-2">Dirección de Desarrollo Comunitario</h6>
                    <p class="text-muted small mb-0">
                        Sistema de Identificación Vehicular
                    </p>
                </div>
                <div class="col-md-4 text-center text-md-end">
                    <p class="text-muted small mb-1">
                        <i class="bi bi-globe me-1"></i>
                        <a href="https://www.didecoarica.cl" target="_blank" class="text-decoration-none text-primary">
                            www.didecoarica.cl
                        </a>
                    </p>
                    <p class="text-muted small mb-0">
                        <i class="bi bi-diagram-2 me-1"></i>Control y Gestión Digital - <?= date('Y') ?>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/didecosistemas/public/vehiculos/vendors/jquery/jquery-3.7.1.min.js"></script>
    <script src="/didecosistemas/public/vehiculos/vendors/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS (global) -->
    <script src="/didecosistemas/public/vehiculos/vendors/datatables/js/jquery.dataTables.min.js"></script>
    <script src="/didecosistemas/public/vehiculos/vendors/datatables/js/dataTables.bootstrap5.min.js"></script>
    <script src="/didecosistemas/public/vehiculos/vendors/datatables/js/dataTables.responsive.min.js"></script>
    <script src="/didecosistemas/public/vehiculos/vendors/datatables/js/responsive.bootstrap5.min.js"></script>
    <script src="/didecosistemas/public/vehiculos/vendors/sweetalert2/sweetalert2.all.min.js"></script>
    <script src="/didecosistemas/public/vehiculos/js/app.js"></script>
    <?= $this->inlineScript() ?>
</body>

</html>